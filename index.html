<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mapa de Centrales (Hidro / Termo) - Colombia</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    html,body{height:100%;margin:0}
    #map{height:100vh;width:100%}
    .map-title{
      position:absolute;top:10px;left:50%;transform:translateX(-50%);
      background:rgba(255,255,255,0.95);padding:10px 16px;border-radius:10px;
      font-weight:700;z-index:1000;box-shadow:0 2px 6px rgba(0,0,0,0.2)
    }
    .info.legend{line-height:18px;color:#333;font-size:14px}
  </style>
</head>
<body>
  <div class="map-title">Mapa de Hidroeléctricas (rojo) y Termoeléctricas (azul) — Colombia</div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
/* ====== JSON MAESTRO (copiado desde tu listado corregido) ====== */
const DATA = {
  "meta":{"generated_on":"2025-09-21"},
  "plants":[
    {"nombre":"Central hidroeléctrica Betania","tipo":"Hidroeléctrica","departamento":"Huila","municipio":"Yaguará / Campoalegre","latitud":2.70829,"longitud":-75.42989,"año_inaugurada":1993,"potencia_MW":540,"rio":"Río Magdalena","approximate":false},
    {"nombre":"Central hidroeléctrica Calderas","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"San Carlos (zona Calderas)","latitud":6.19030,"longitud":-74.99020,"año_inaugurada":1988,"potencia_MW":26,"rio":"Río Calderas / Río Tafetanes","approximate":true},
    {"nombre":"Central hidroeléctrica de Chivor","tipo":"Hidroeléctrica","departamento":"Boyacá","municipio":"Santa María / Chivor (zona)","latitud":5.16330,"longitud":-73.35670,"año_inaugurada":1970,"potencia_MW":1000,"rio":"Río Batá","approximate":false},
    {"nombre":"Central hidroeléctrica del Alto Anchicayá","tipo":"Hidroeléctrica","departamento":"Valle del Cauca","municipio":"Dagua / Buenaventura (zona)","latitud":3.60800,"longitud":-76.89170,"año_inaugurada":1974,"potencia_MW":355,"rio":"Río Anchicayá","approximate":false},
    {"nombre":"Central hidroeléctrica del Guavio (Alberto Lleras)","tipo":"Hidroeléctrica","departamento":"Cundinamarca","municipio":"Ubalá / Gachalá (zona embalse)","latitud":4.73580,"longitud":-73.35260,"año_inaugurada":1992,"potencia_MW":1250,"rio":"Río Guavio","approximate":false},
    {"nombre":"Central hidroeléctrica El Quimbo","tipo":"Hidroeléctrica","departamento":"Huila","municipio":"Gigante / El Agrado (zona embalse)","latitud":2.45303,"longitud":-75.56441,"año_inaugurada":2015,"potencia_MW":400,"rio":"Río Magdalena","approximate":false},
    {"nombre":"Central hidroeléctrica Jaguas","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"San Rafael (zona)","latitud":6.35500,"longitud":-75.00500,"año_inaugurada":1988,"potencia_MW":170,"rio":"Río Nare / Río Guatapé","approximate":false},
    {"nombre":"Central Hidroeléctrica La Tasajera (EPM)","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"Girardota / Barbosa (zona)","latitud":6.412835,"longitud":-75.429424,"año_inaugurada":1993,"potencia_MW":306,"rio":"Río Grande","approximate":false},
    {"nombre":"Central hidroeléctrica Miel I (Patángoras)","tipo":"Hidroeléctrica","departamento":"Caldas","municipio":"Norcasia","latitud":5.56056,"longitud":-74.88667,"año_inaugurada":2002,"potencia_MW":396,"rio":"Río La Miel","approximate":false},
    {"nombre":"Central hidroeléctrica Playas","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"San Rafael / San Carlos (zona)","latitud":6.30490,"longitud":-75.02490,"año_inaugurada":2023,"potencia_MW":201,"rio":"Río Nare / Río Guatapé","approximate":false},
    {"nombre":"Central hidroeléctrica Río Amoyá - La Esperanza","tipo":"Hidroeléctrica","departamento":"Tolima","municipio":"Chaparral (zona)","latitud":3.80610,"longitud":-75.59310,"año_inaugurada":2013,"potencia_MW":80,"rio":"Río Amoyá","approximate":false},
    {"nombre":"Central hidroeléctrica Salvajina","tipo":"Hidroeléctrica","departamento":"Cauca","municipio":"Suárez","latitud":2.94240,"longitud":-76.70640,"año_inaugurada":1985,"potencia_MW":285,"rio":"Río Cauca","approximate":false},
    {"nombre":"Central hidroeléctrica San Carlos","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"San Carlos (zona central)","latitud":6.21370,"longitud":-74.81610,"año_inaugurada":1984,"potencia_MW":1240,"rio":"Río San Carlos / Río Guatapé","approximate":false},
    {"nombre":"Embalse Peñol-Guatapé (Central Guatapé)","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"Guatapé / El Peñol (zona)","latitud":6.23330,"longitud":-75.16970,"año_inaugurada":1972,"potencia_MW":560,"rio":"Río Nare","approximate":false},
    {"nombre":"Hidroeléctrica de Sogamoso","tipo":"Hidroeléctrica","departamento":"Santander","municipio":"Betulia / Zona embalse","latitud":7.10110,"longitud":-73.40750,"año_inaugurada":2014,"potencia_MW":820,"rio":"Río Sogamoso","approximate":false},
    {"nombre":"Hidroituango","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"Ituango (zona proyecto)","latitud":7.13470,"longitud":-75.66240,"año_inaugurada":2022,"potencia_MW":1200,"rio":"Río Cauca","approximate":true},
    {"nombre":"Represa Urrá I","tipo":"Hidroeléctrica","departamento":"Córdoba","municipio":"Tierralta (zona Urrá)","latitud":8.00910,"longitud":-76.07640,"año_inaugurada":1993,"potencia_MW":340,"rio":"Río Sinú","approximate":true},
    {"nombre":"Porce I","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"Amalfi (zona Porce)","latitud":6.77280,"longitud":-75.17110,"año_inaugurada":1983,"potencia_MW":120,"rio":"Río Porce","approximate":false},
    {"nombre":"Porce II","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"Amalfi (zona Porce)","latitud":6.80560,"longitud":-75.14910,"año_inaugurada":2001,"potencia_MW":405,"rio":"Río Porce","approximate":false},
    {"nombre":"Porce III","tipo":"Hidroeléctrica","departamento":"Antioquia","municipio":"Amalfi / Guadalupe (zona)","latitud":6.93932,"longitud":-75.13902,"año_inaugurada":2011,"potencia_MW":660,"rio":"Río Porce","approximate":false},
    {"nombre":"Termoguajira (GECELCA)","tipo":"Termoeléctrica","departamento":"La Guajira","municipio":"Dibulla / Puerto Bolívar (zona)","latitud":11.262213,"longitud":-73.415568,"año_inaugurada":1983,"potencia_MW":290,"combustible":"Carbón / respaldo gas","approximate":false},
    {"nombre":"Termobarranquilla (TEBSA)","tipo":"Termoeléctrica","departamento":"Atlántico","municipio":"Soledad / Barranquilla (zona)","latitud":10.937252,"longitud":-74.764098,"año_inaugurada":1995,"potencia_MW":918,"combustible":"Gas natural / fuel oil","approximate":false},
    {"nombre":"Termoflores (Las Flores)","tipo":"Termoeléctrica","departamento":"Atlántico","municipio":"Barranquilla (zona)","latitud":11.02600,"longitud":-74.81250,"año_inaugurada":1993,"potencia_MW":610,"combustible":"Gas natural","approximate":false},
    {"nombre":"Termocandelaria","tipo":"Termoeléctrica","departamento":"Bolívar","municipio":"Cartagena (Mamonal)","latitud":10.35840,"longitud":-75.48580,"año_inaugurada":2000,"potencia_MW":314,"combustible":"Gas / fuel oil","approximate":false},
    {"nombre":"Termocartagena (Enel)","tipo":"Termoeléctrica","departamento":"Bolívar","municipio":"Cartagena (Mamonal)","latitud":10.39900,"longitud":-75.48400,"año_inaugurada":1990,"potencia_MW":190,"combustible":"Gas / fuel oil","approximate":false},
    {"nombre":"TermoemCali","tipo":"Termoeléctrica","departamento":"Valle del Cauca","municipio":"Palmira","latitud":3.54300,"longitud":-76.35000,"año_inaugurada":1999,"potencia_MW":220,"combustible":"Gas natural / fuel oil","approximate":true},
    {"nombre":"Termovalle","tipo":"Termoeléctrica","departamento":"Valle del Cauca","municipio":"Palmira (zona industrial)","latitud":3.56490,"longitud":-76.45320,"año_inaugurada":1998,"potencia_MW":220,"combustible":"Gas natural / fuel oil","approximate":true},
    {"nombre":"Termozipa","tipo":"Termoeléctrica","departamento":"Cundinamarca","municipio":"Tocancipá / Zipaquirá (zona)","latitud":4.970817,"longitud":-73.947258,"año_inaugurada":1965,"potencia_MW":236,"combustible":"Carbón / gas","approximate":false},
    {"nombre":"TermoPaipa (Termopaipa)","tipo":"Termoeléctrica","departamento":"Boyacá","municipio":"Paipa","latitud":5.76820,"longitud":-73.14720,"año_inaugurada":1963,"potencia_MW":338,"combustible":"Carbón","approximate":false},
    {"nombre":"Termotasajero I y II","tipo":"Termoeléctrica","departamento":"Norte de Santander","municipio":"Cúcuta / San Cayetano (zona)","latitud":7.84730,"longitud":-72.63280,"año_inaugurada":1984,"potencia_MW":333,"combustible":"Carbón","approximate":true},
    {"nombre":"Termosierra","tipo":"Termoeléctrica","departamento":"Cesar","municipio":"La Jagua de Ibirico (zona)","latitud":9.57000,"longitud":-73.33000,"año_inaugurada":1993,"potencia_MW":300,"combustible":"Carbón","approximate":false},
    {"nombre":"Meriléctrica (Celsia)","tipo":"Termoeléctrica","departamento":"Santander","municipio":"Barrancabermeja (zona)","latitud":7.05430,"longitud":-73.82000,"año_inaugurada":1998,"potencia_MW":167,"combustible":"Gas / fuel oil","approximate":false},
    {"nombre":"El Tesorito (Celsia)","tipo":"Termoeléctrica","departamento":"Córdoba","municipio":"Sahagún (zona)","latitud":8.93390,"longitud":-75.48170,"año_inaugurada":2022,"potencia_MW":200,"combustible":"Gas natural","approximate":false},
    {"nombre":"Termocentro (varias unidades)","tipo":"Termoeléctrica","departamento":"Valle del Cauca / Tolima (varias)","municipio":"Varias","latitud":4.00000,"longitud":-75.00000,"año_inaugurada":null,"potencia_MW":272,"combustible":"Gas / diésel","approximate":true},
    {"nombre":"Termoyopal","tipo":"Termoeléctrica","departamento":"Casanare","municipio":"Yopal / El Morro (zona)","latitud":5.33100,"longitud":-72.39100,"año_inaugurada":2000,"potencia_MW":186,"combustible":"Gas natural","approximate":false},
    {"nombre":"Plantas Mamonal (pequeñas, Cartagena)","tipo":"Termoeléctrica","departamento":"Bolívar","municipio":"Cartagena (Mamonal)","latitud":10.38000,"longitud":-75.50000,"año_inaugurada":null,"potencia_MW":100,"combustible":"Gas / diésel","approximate":true},
    {"nombre":"Gecelca 1","tipo":"Termoeléctrica","departamento":"Córdoba","municipio":"Montelíbano / Puerto Libertador (zona)","latitud":7.98000,"longitud":-75.60000,"año_inaugurada":2000,"potencia_MW":164,"combustible":"Carbón","approximate":true},
    {"nombre":"Gecelca 2","tipo":"Termoeléctrica","departamento":"Córdoba","municipio":"Puerto Libertador (zona)","latitud":7.98800,"longitud":-75.59000,"año_inaugurada":2005,"potencia_MW":164,"combustible":"Carbón","approximate":true},
    {"nombre":"Gecelca 3","tipo":"Termoeléctrica","departamento":"Córdoba","municipio":"Puerto Libertador","latitud":7.99111,"longitud":-75.59456,"año_inaugurada":2015,"potencia_MW":164,"combustible":"Carbón","approximate":false},
    {"nombre":"Gecelca 3.2","tipo":"Termoeléctrica","departamento":"Córdoba","municipio":"Puerto Libertador","latitud":7.98500,"longitud":-75.60000,"año_inaugurada":2024,"potencia_MW":273,"combustible":"Carbón","approximate":true}
  ]
};

/* ====== UTIL: normaliza cualquier variante de campo al esquema que usamos en el popup ====== */
function normalize(raw){
  const p = raw || {};
  const name = p.nombre || p.name || p.nombre_central || "";
  const type = p.tipo || p.type || "";
  const departamento = p.departamento || p.dept || p.dpto || p.department || "";
  const municipio = p.municipio || p.municipio_s || p.municipio || p.city || "";
  // lat/lon posibles nombres
  const lat = (p.lat !== undefined) ? p.lat : (p.latitud !== undefined ? p.latitud : (p.latitude !== undefined ? p.latitude : (p.Lat !== undefined ? p.Lat : undefined)));
  const lon = (p.lng !== undefined) ? p.lng : (p.lon !== undefined ? p.lon : (p.longitud !== undefined ? p.longitud : (p.longitude !== undefined ? p.longitude : undefined)));
  const potencia = p.potencia_MW || p.potencia || p.mw || p.power || null;
  const year = p.año_inaugurada || p.año || p.year || p.inauguration || null;
  const rio = p.rio || p.river || "";
  const fuel = p.combustible || p.fuel || "";
  const approx = (p.approximate===true) ? true : false;
  return {
    name:String(name||"").trim(),
    type: String(type||"").trim(),
    departamento: String(departamento||"").trim(),
    municipio: String(municipio||"").trim(),
    lat: lat === undefined ? null : Number(lat),
    lon: lon === undefined ? null : Number(lon),
    potencia: potencia === undefined ? null : potencia,
    year: year === undefined ? null : year,
    rio: rio,
    fuel: fuel,
    approx: approx
  };
}

/* ====== Inicializar mapa ====== */
const map = L.map('map').setView([5.0, -74.5], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'© OpenStreetMap contributors'}).addTo(map);

/* ====== Iconos/Estilo ====== */
function markerOptionsByType(type){
  if(type && type.toLowerCase().includes('hidro')) {
    return { radius:7, fillColor:'red', color:'#fff', weight:1, fillOpacity:0.9 };
  }
  return { radius:7, fillColor:'blue', color:'#fff', weight:1, fillOpacity:0.9 };
}

/* ====== Dibujar plantas (con control de errores) ====== */
const missingCoords = [];
DATA.plants.forEach(raw=>{
  const p = normalize(raw);
  if(p.lat === null || isNaN(p.lat) || p.lon === null || isNaN(p.lon)){
    console.warn(`Plant skipped - missing coords: ${p.name || raw.nombre || raw.name}`, raw);
    missingCoords.push(raw);
    return;
  }
  const opts = markerOptionsByType(p.type);
  const marker = L.circleMarker([p.lat, p.lon], opts).addTo(map);
  const popupParts = [
  `<strong>${p.name || p.nombre || '(sin nombre)'}</strong>`,
  `Tipo: ${p.type || p.tipo || '(sin tipo)'}`,
  (p.departamento ? `Departamento: ${p.departamento}` : ''),
  (p.municipio ? `Municipio: ${p.municipio}` : ''),
  (p.potencia || p.capacidad_MW ? `Potencia: ${p.potencia || p.capacidad_MW} MW` : ''),
  (p.year || p.año ? `Año: ${p.year || p.año}` : ''),
  (p.rio || p.río ? `Río: ${p.rio || p.río}` : ''),
  (p.fuel || p.combustible ? `Combustible: ${p.fuel || p.combustible}` : ''),
  (p.lat && (p.lon || p.lng) ? `Coordenadas: ${p.lat}, ${p.lon || p.lng}` : '')
].filter(Boolean).join('<br>');

marker.bindPopup(popupParts);

});

/* ====== Leyenda fija (inferior derecha) ====== */
const legend = L.control({position:'bottomright'});
legend.onAdd = function(map){
  const div = L.DomUtil.create('div','info legend');
  div.innerHTML = `
    <h4>Tipos de Plantas</h4>
    <i style="background:red; width:12px; height:12px; display:inline-block; margin-right:6px"></i> Hidroeléctrica<br>
    <i style="background:blue; width:12px; height:12px; display:inline-block; margin-right:6px"></i> Termoeléctrica
  `;
  div.style.background='white'; div.style.padding='8px'; div.style.borderRadius='8px'; div.style.boxShadow='0 2px 6px rgba(0,0,0,0.2)';
  return div;
};
legend.addTo(map);

/* ====== Mensaje de depuración visible en consola ====== */
if(window.console && missingCoords.length){
  console.info(`Plantas omitidas por falta de coordenadas: ${missingCoords.length}. Revisa la consola para ver cuáles son.`);
}
  </script>
</body>
</html>
